
 <!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  
    <title>Java核心机制 | liuwc&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="liuwc">
    

    
    <meta name="description" content="Annotation注解和内置注解Annotation是从JDK5.0开始引入的新技术1.Annotation的作用:    -不是程序本身,可以对程序做出解释。(这一点，跟注释没什么区别)    -可以被其他程序(比如：编译器等)读取。(注解信息处理流程，是注解和注释的重大区别。如果没有注解信息处理流程,则注解毫无意义)2.Annotation的格式:    -注解是以”@注释名”在代码中存在的">
<meta property="og:type" content="article">
<meta property="og:title" content="Java核心机制">
<meta property="og:url" content="http://www.liuwc.com/2018/02/12/hxjz/index.html">
<meta property="og:site_name" content="liuwc&#39;s blog">
<meta property="og:description" content="Annotation注解和内置注解Annotation是从JDK5.0开始引入的新技术1.Annotation的作用:    -不是程序本身,可以对程序做出解释。(这一点，跟注释没什么区别)    -可以被其他程序(比如：编译器等)读取。(注解信息处理流程，是注解和注释的重大区别。如果没有注解信息处理流程,则注解毫无意义)2.Annotation的格式:    -注解是以”@注释名”在代码中存在的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://slvanass-1256457820.cos.ap-guangzhou.myqcloud.com/2fb054008ca2898e0a17f7d79ce525a1.png">
<meta property="og:updated_time" content="2018-04-11T01:15:40.085Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java核心机制">
<meta name="twitter:description" content="Annotation注解和内置注解Annotation是从JDK5.0开始引入的新技术1.Annotation的作用:    -不是程序本身,可以对程序做出解释。(这一点，跟注释没什么区别)    -可以被其他程序(比如：编译器等)读取。(注解信息处理流程，是注解和注释的重大区别。如果没有注解信息处理流程,则注解毫无意义)2.Annotation的格式:    -注解是以”@注释名”在代码中存在的">
<meta name="twitter:image" content="https://slvanass-1256457820.cos.ap-guangzhou.myqcloud.com/2fb054008ca2898e0a17f7d79ce525a1.png">

    
    <link rel="alternative" href="/atom.xml" title="liuwc&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="liuwc&#39;s blog">liuwc&#39;s blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.liuwc.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/02/12/hxjz/" title="Java核心机制" itemprop="url">Java核心机制</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="liuwc" target="_blank" itemprop="author">liuwc</a>
		
  <p class="article-time">
    <time datetime="2018-02-12T01:58:10.000Z" itemprop="datePublished"> 发表于 2018-02-12</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Annotation注解和内置注解"><span class="toc-number">1.</span> <span class="toc-text">Annotation注解和内置注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自定义注解"><span class="toc-number">2.</span> <span class="toc-text">自定义注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制读取注解"><span class="toc-number">3.</span> <span class="toc-text">反射机制读取注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制介绍（Class对象获取、合并文件）"><span class="toc-number">4.</span> <span class="toc-text">反射机制介绍（Class对象获取、合并文件）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制（动态操作、构造器、方法、属性、合并文件）"><span class="toc-number">5.</span> <span class="toc-text">反射机制（动态操作、构造器、方法、属性、合并文件）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制（提高反射效率、操作泛型、操作注解、合并文件）"><span class="toc-number">6.</span> <span class="toc-text">反射机制（提高反射效率、操作泛型、操作注解、合并文件）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态编译（DynamicCompile、反射调用main方法）"><span class="toc-number">7.</span> <span class="toc-text">动态编译（DynamicCompile、反射调用main方法）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#脚本引擎执行Javascript代码（Rhino引擎）"><span class="toc-number">8.</span> <span class="toc-text">脚本引擎执行Javascript代码（Rhino引擎）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器"><span class="toc-number">9.</span> <span class="toc-text">字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字节码操作（Javaassist库介绍、API详解）"><span class="toc-number">10.</span> <span class="toc-text">字节码操作（Javaassist库介绍、API详解）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）"><span class="toc-number">11.</span> <span class="toc-text">JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）"><span class="toc-number">12.</span> <span class="toc-text">JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）"><span class="toc-number">13.</span> <span class="toc-text">JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器"><span class="toc-number">14.</span> <span class="toc-text">JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载器、自定加密解密类加载器）"><span class="toc-number">15.</span> <span class="toc-text">JVM核心机制（类加载器、自定加密解密类加载器）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）"><span class="toc-number">16.</span> <span class="toc-text">JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）"><span class="toc-number">17.</span> <span class="toc-text">内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）</span></a></li></ol>
		
		</div>
		
		<h1 id="Annotation注解和内置注解"><a href="#Annotation注解和内置注解" class="headerlink" title="Annotation注解和内置注解"></a>Annotation注解和内置注解</h1><p>Annotation是从JDK5.0开始引入的新技术<br>1.Annotation的作用:<br>    -不是程序本身,可以对程序做出解释。(这一点，跟注释没什么区别)<br>    -可以被其他程序(比如：编译器等)读取。(注解信息处理流程，是注解和注释的重大区别。如果没有注解信息处理流程,则注解毫无意义)<br>2.Annotation的格式:<br>    -注解是以”@注释名”在代码中存在的，还可以添加一些参数值,例如：@SuppressWarnings(value=”unchecked”)。<br>3.Annotation在哪里使用?<br>    -可以附加在packages,class,method,field等上面,相当于给它们添加了额外的辅助信息,我们可以通过反射机制编程实现对这些元数据的访问。<br>内置注解(1)<br>1.@Override<br>    -定义在java.lang.Override中,此注释只适用于修辞方法,表示一个方法声明打算重写超类中的另一个方法声明。<br>2.@Deprecated<br>    -定义在java.lang.Deprecated中,此注释可用于修辞方法、属性、类,表示不鼓励程序员使用这样的元素,通常是因为它很危险或存在更好的选择。<br>3.@SuppressWarnings<br>    -定义在java.lang.SuppressWarings中,用来抑制编译时的警告信息<br>    -与前两个注解有所不同,你需要添加一个参数才能使用,这些参数值都是已经定义好的，我们选择性的使用就好了，参数如下</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">deprecation</td>
<td style="text-align:center">使用了过时的类或方法的警告</td>
</tr>
<tr>
<td style="text-align:center">unchecked</td>
<td style="text-align:center">执行了未检查的转换时的警告,如使用集合时未指定泛型</td>
</tr>
<tr>
<td style="text-align:center">fallthrough</td>
<td style="text-align:center">当在switch语句使用时发生case穿透</td>
</tr>
<tr>
<td style="text-align:center">path</td>
<td style="text-align:center">在类路径、源文件路径等中有不存在路径的警告</td>
</tr>
<tr>
<td style="text-align:center">serial</td>
<td style="text-align:center">当在可序列化的类上缺少serialVersionUID定义时的警告</td>
</tr>
<tr>
<td style="text-align:center">finally</td>
<td style="text-align:center">任何finally子句不能完成时的警告</td>
</tr>
<tr>
<td style="text-align:center">all</td>
<td style="text-align:center">关于以上所有情况的警告</td>
</tr>
</tbody>
</table>
<pre><code>-@SuppressWarnings(value=&quot;unchecked&quot;)
-@SuppressWarnings(value={&quot;unchecked&quot;,&quot;deprecation&quot;})
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span>/*<span class="keyword">extends</span> <span class="title">Object</span>*/ </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test001</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test001"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test002</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        List list2 = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Date d = <span class="keyword">new</span> Date();</span><br><span class="line">        test001();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h1><p>1.使用@interface自定义注解时,自动继承了java.lang.annotation.Annotation接口<br>2.要点：<br>    -@interface用来声明一个注解<br>        *格式为：public @interface 注解名{定义体}<br>    -其中的每一个方法实际上是声明了一个配置参数。<br>    -返回值类型就是参数的类型(返回值类型只能是基本类型、Class、String、enum)。<br>    -可以通过default来声明参数的默认值<br>    -如果只有一个参数成员,一半参数名为value<br>元注解：<br>1.元注解的作用就是负责注解其他注解。java定义了4个标准的meta-annotation类型,它们被用来提供对其它annotation类型做说明。<br>2.这些类型和它们所支持的类在java.lang.annotation包中可以找到<br>    -@Target<br>    -@Retention<br>    -@Documented<br>    -@Inherited<br>注意：<br>    -注解元素必须要有值。我们定义注解元素时，经常使用空字符串、0作为默认值<br>    -也经常使用负数(比如：-1)表示不存在的含义<br>1)、@Target<br>    -作用：<br>    用于描述注解的使用范围(即:被描述的注解可以用在什么地方)<br>| 所修饰范围 | 取值ElementType |<br>|:—:|:—:|<br>|package 包|PACKAGE|<br>|类、接口、枚举、Annotation类型|TYPE|<br>|类型成员(方法、构造方法、成员变量、枚举值)|CONSTRUCTOR:用于描述构造器 FIELD:用于描述域 METHOD:用于描述方法|<br>|方法参数和本地变量|LOCAL_VARIABLE:用于描述局部变量 PARAMETER:用于描述参数|<br>    -Target(value=ElementType.TYPE)<br>2)、Retention<br>    -作用：<br>    表示需要在什么级别保存该注释信息,用于描述注解的生命周期<br>| 取值 RetentionPolicy | 作用 |<br>|:—:|:—:|<br>|SOURCE|作用|<br>|CLASS|在class文件中有效(即class保留)|<br>|RUNTIME|在运行时有效(即运行时保留) 为Runtime可以被反射机制读取|<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(value= &#123;ElementType.METHOD,ElementType.TYPE&#125;)<span class="comment">//此注解只能用于方法和类</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)<span class="comment">//可以被反射读取</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SxtAnnotation01 &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">String <span class="title">studentName</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;<span class="comment">//参数类型 参数名</span></span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;<span class="comment">//String indexOf("abc") -1表示不存在</span></span><br><span class="line"></span><br><span class="line">        String[] schools() <span class="keyword">default</span> &#123;<span class="string">"清华大学"</span>,<span class="string">"北京尚学堂"</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(value= &#123;ElementType.METHOD,ElementType.TYPE&#125;)<span class="comment">//此注解只能用于方法和类</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)<span class="comment">//可以被反射读取</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SxtAnnotation02 &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SxtAnnotation</span>01(age = <span class="number">19</span>,studentName = <span class="string">"老高"</span>,id=<span class="number">1001</span>,</span><br><span class="line">            schools = &#123;<span class="string">"北京大学"</span>,<span class="string">"北京航空航天大学"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SxtAnnotation</span>02(value=<span class="string">"aaaa"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="反射机制读取注解"><a href="#反射机制读取注解" class="headerlink" title="反射机制读取注解"></a>反射机制读取注解</h1><p>1.什么是ORM(Object Relationship Mapping)?<br>    -类和表结构对应<br>    -属性和字段对应<br>    -对象和记录对应<br>2.使用注解完成类和表结构的映射关系<br>    -学习了反射机制后,我们可以定义注解处理流程读取这些注解,实现更加复杂的功能。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SxtTable</span>(<span class="string">"tb_student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SxtStudent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SxtField</span>(columnName = <span class="string">"id"</span>,type=<span class="string">"int"</span>,length = <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@SxtField</span>(columnName = <span class="string">"sname"</span>,type=<span class="string">"varchar"</span>,length = <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">private</span> String studentName;</span><br><span class="line">    <span class="meta">@SxtField</span>(columnName = <span class="string">"age"</span>,type=<span class="string">"int"</span>,length = <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStudentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> studentName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStudentName</span><span class="params">(String studentName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentName = studentName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(value= &#123;ElementType.METHOD,ElementType.TYPE&#125;)<span class="comment">//此注解只能用于方法和类</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)<span class="comment">//可以被反射读取</span></span><br><span class="line"><span class="meta">@SxtTable</span>(<span class="string">"tb_student"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SxtTable &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.test.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(value= &#123;ElementType.METHOD,ElementType.TYPE&#125;)<span class="comment">//此注解只能用于方法和类</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)<span class="comment">//可以被反射读取</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SxtTable &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="反射机制介绍（Class对象获取、合并文件）"><a href="#反射机制介绍（Class对象获取、合并文件）" class="headerlink" title="反射机制介绍（Class对象获取、合并文件）"></a>反射机制介绍（Class对象获取、合并文件）</h1><p>● 动态语言<br>    -程序运行时,可以改变程序结构或变量类型。典型的语言：<br>    <em>python、ruby、javascript等。
    </em>如下javascript代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    var s = <span class="string">"var a=3;var b=5;alert(a+b);"</span>;</span><br><span class="line">    eval(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>● C，C++，JAVA不是动态语言，但是JAVA有一定的动态性，我们可以利用反射机制、字节码操作获得类似动态语言的特性。<br>● JAVA的动态性让编程的时候更加灵活!<br>1.反射机制<br>    -指的是可以于运行时加载、探知、使用编译期间完全未知的类。<br>    -程序在运行状态中,可以动态加载一个只有名称的类,对于任意一个已加载的类,都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性；<br>        Class c = Class.forName(“com.bjsxt.test.User”);<br>    -加载完成类之后,在堆内存中，就产生了一个Class类型的对象(一个类只有一个Class对象),这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，透过这个镜子看到类的结构，所以，我们形象的称之为：反射。<br>2.反射机制的常见作用<br>    ● 动态加载类、东台获取类的信息（属性、方法、构造器）<br>    ● 动态构造对象<br>    ● 动态调用类和对象的任意方法、构造器<br>    ● 动态调用和处理属性<br>    ● 获取泛型信息<br>    ● 处理注解<br>3.Class类的对象如何获取？<br>    ● 运用getClass()<br>    ● 运用Class.forName(){最常被使用}<br>    ● 运用.class语法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.reflection.bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String uname;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">int</span> age, String uname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.uname = uname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> uname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUname</span><span class="params">(String uname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.uname = uname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.reflection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> * 测试各种类型(class,interface,enum,annotation,primitive type,void)</span></span><br><span class="line"><span class="comment"> * 对应的java.lang.Class对象的获取方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String path = <span class="string">"com.bjsxt.reflection.bean.User"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(path);</span><br><span class="line">            <span class="comment">//对象是表示或封装一些数据。一个类被加载后，JVM会创建一个对应该类的Class对象，类的整个结构信息会放到对应的Class对象中。</span></span><br><span class="line">            <span class="comment">//这个Class对象就像一面镜子一样，通过这面镜子我可以看到对应类的全部信息。</span></span><br><span class="line">            System.out.println(clazz.hashCode());</span><br><span class="line"></span><br><span class="line">            Class clazz2 = Class.forName(path);<span class="comment">//一个类只对应一个class对象</span></span><br><span class="line">            System.out.println(clazz2.hashCode());<span class="comment">//相同</span></span><br><span class="line"></span><br><span class="line">            Class strClazz = String.class;</span><br><span class="line">            Class strClazz2 = path.getClass();</span><br><span class="line">            System.out.println(strClazz==strClazz2);<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line">            Class intClazz = <span class="keyword">int</span>.class;</span><br><span class="line">            <span class="comment">//hashcode相同</span></span><br><span class="line">            <span class="keyword">int</span>[] arr01 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">int</span>[] arr02 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">30</span>];</span><br><span class="line">             <span class="comment">//hashcode相同</span></span><br><span class="line">            <span class="keyword">int</span>[][] arr03 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">30</span>][<span class="number">3</span>];</span><br><span class="line">            <span class="keyword">int</span>[][] arr04 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>][<span class="number">3</span>];</span><br><span class="line">             <span class="comment">//hashcode相同</span></span><br><span class="line">            <span class="keyword">double</span>[] arr05 = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">double</span>[] arr06 = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">30</span>];</span><br><span class="line">            System.out.println(arr01.getClass().hashCode());</span><br><span class="line">            System.out.println(arr02.getClass().hashCode());</span><br><span class="line">            System.out.println(arr03.getClass().hashCode());</span><br><span class="line">            System.out.println(arr04.getClass().hashCode());</span><br><span class="line">            System.out.println(arr05.getClass().hashCode());</span><br><span class="line">            System.out.println(arr06.getClass().hashCode());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="反射机制（动态操作、构造器、方法、属性、合并文件）"><a href="#反射机制（动态操作、构造器、方法、属性、合并文件）" class="headerlink" title="反射机制（动态操作、构造器、方法、属性、合并文件）"></a>反射机制（动态操作、构造器、方法、属性、合并文件）</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.reflection;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> * 运用反射的API获取类的信息(类的名字、属性、方法、构造器等)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String path = <span class="string">"com.bjsxt.reflection.bean.User"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(path);</span><br><span class="line">            <span class="comment">//获取类名+包名：com.bjsxt.reflection.bean.User</span></span><br><span class="line">            System.out.println(clazz.getName());</span><br><span class="line">            <span class="comment">//获得类名:User</span></span><br><span class="line">            System.out.println(clazz.getSimpleName());</span><br><span class="line">            <span class="comment">//获取属性信息</span></span><br><span class="line">            <span class="comment">//Field[] fields =clazz.getFields();//只能获得public的field</span></span><br><span class="line">            Field[] fields = clazz.getDeclaredFields();<span class="comment">//获得所有的field</span></span><br><span class="line">            Field f = clazz.getDeclaredField(<span class="string">"uname"</span>);</span><br><span class="line">            System.out.println(fields.length);</span><br><span class="line">            <span class="keyword">for</span>(Field temp:fields)&#123;</span><br><span class="line">                System.out.println(<span class="string">"属性："</span>+temp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取方法信息</span></span><br><span class="line">            Method[] methods = clazz.getDeclaredMethods();</span><br><span class="line">            Method m01 = clazz.getDeclaredMethod(<span class="string">"getUname"</span>,<span class="keyword">null</span>);</span><br><span class="line">            <span class="comment">//如果方法有阐述，则必须传递参数类型对应的class的对象</span></span><br><span class="line">            Method m02 = clazz.getDeclaredMethod(<span class="string">"setUname"</span>,String.class);</span><br><span class="line">            <span class="keyword">for</span>(Method m:methods)&#123;</span><br><span class="line">                System.out.println(<span class="string">"方法："</span>+m);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获得构造器信息</span></span><br><span class="line">            Constructor[] constructors = clazz.getDeclaredConstructors();<span class="comment">//获得所有构造器</span></span><br><span class="line">            Constructor c=clazz.getDeclaredConstructor(<span class="keyword">null</span>);<span class="comment">//获得无参构造器</span></span><br><span class="line">            Constructor c2=clazz.getDeclaredConstructor(<span class="keyword">int</span>.class,<span class="keyword">int</span>.class,String.class);</span><br><span class="line">            System.out.println(<span class="string">"获得构造器："</span>+c);</span><br><span class="line">            System.out.println(<span class="string">"获得构造器："</span>+c2);</span><br><span class="line">            <span class="keyword">for</span>(Constructor temp:constructors)&#123;</span><br><span class="line">                System.out.println(<span class="string">"构造器："</span>+temp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.reflection.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/3.</span></span><br><span class="line"><span class="comment"> * 通过反射API动态的操作:构造器、方法、属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String path = <span class="string">"com.bjsxt.reflection.bean.User"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;User&gt; clazz = (Class&lt;User&gt;) Class.forName(path);</span><br><span class="line">            <span class="comment">//通过反射API调用构造方法,构造对象</span></span><br><span class="line">            User u = clazz.newInstance();<span class="comment">//其实是调用了User的无参构造方法</span></span><br><span class="line">            System.out.println(u);</span><br><span class="line"></span><br><span class="line">            Constructor&lt;User&gt; c = clazz.getDeclaredConstructor(<span class="keyword">int</span>.class,<span class="keyword">int</span>.class,String.class);</span><br><span class="line">            User u2 = c.newInstance(<span class="number">1001</span>,<span class="number">18</span>,<span class="string">"小明"</span>);</span><br><span class="line">            System.out.println(u2.getUname());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过反射API调用普通方法</span></span><br><span class="line">            User u3 = clazz.newInstance();</span><br><span class="line">            Method method = clazz.getDeclaredMethod(<span class="string">"setUname"</span>,String.class);</span><br><span class="line">            method.invoke(u3,<span class="string">"小明2"</span>);<span class="comment">//激活 等于实现了u3.setUname("小明2");</span></span><br><span class="line">            System.out.println(u3.getUname());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过反射API操作属性</span></span><br><span class="line">            User u4 = clazz.newInstance();</span><br><span class="line">            Field f = clazz.getDeclaredField(<span class="string">"uname"</span>);</span><br><span class="line">            f.setAccessible(<span class="keyword">true</span>);<span class="comment">//这个属性不需要安全检查、直接访问</span></span><br><span class="line">            f.set(u4,<span class="string">"小明3"</span>);<span class="comment">//通过反射直接写属性</span></span><br><span class="line">            System.out.println(u4.getUname());<span class="comment">//通过反射直接读属性</span></span><br><span class="line">            System.out.println(f.get(u4));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="反射机制（提高反射效率、操作泛型、操作注解、合并文件）"><a href="#反射机制（提高反射效率、操作泛型、操作注解、合并文件）" class="headerlink" title="反射机制（提高反射效率、操作泛型、操作注解、合并文件）"></a>反射机制（提高反射效率、操作泛型、操作注解、合并文件）</h1><p>反射机制性能问题<br>    ● setAccessible</p>
<pre><code>- 启用和禁用访问安全检查的开关,值为true,则指示反射的对象在使用时应该取消java语言访问检查,值为false则指示反射的对象应该实施java语言访问检查,并不是为true就能访问为false就不能访问。
- 禁止安全检查,可以提高反射的运行速度。
● 可以考虑使用:cglib/javaassist字节码操作
</code></pre><p>反射操作泛型<br>    ● java采用泛型擦除的机制来引入泛型。java中的泛型仅仅是给编译器javac使用的,确保数据的安全性和免去强制类型转换的麻烦。但是,一旦编译完成,所有的和泛型有关的类型全部擦除。<br>    ● 为了通过反射操作这些类型以迎合实际开发的需要,java就新增了ParameterizedType,GenericArraytype,TypeVariable和WildcardType几种类型来代表不能被归一到Class类中的类型但是又和原始类型齐名的类型。<br>    ● parameterizedType:表示一种参数化的类型,不如Collection<string><br>    ● GenericArrayType:表示一种元素类型是参数化类型或者类型变量的数组类型<br>    ● WildcardType:代表一种通配符类型表达式,比如?,?extends Number,? super Integer [wildcard是一个单词:就是”通配符”]<br>反射操作注解<br>    ● 可以通过反射API:getAnnotations,getAnnotation获得相关的注解信息<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得类的所有有效注解</span></span><br><span class="line">Annotation[] annotations = clazz.getAnnotations();</span><br><span class="line"><span class="keyword">for</span>(Annotation a:annotation)&#123;</span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获得类的指定的注解</span></span><br><span class="line">SxtTable st = clazz.getAnnotation(SxtTable.class);</span><br><span class="line"> System.out.println(st.value());</span><br><span class="line"><span class="comment">//获得类的属性的注解</span></span><br><span class="line">Field f = clazz.getDeclaredField(<span class="string">"studentName"</span>);</span><br><span class="line">SxtField sxtField = f.getAnnotation(SxtField.class);</span><br><span class="line">System.out.println(sxtField.columnName()+<span class="string">"--"</span>+sxtField.type()+<span class="string">"--"</span>+sxtField.length());</span><br></pre></td></tr></table></figure></string></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.reflection.bean.User;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/4.</span></span><br><span class="line"><span class="comment"> * 通过反射获取指定方法参数泛型信息和指定方法返回值泛型信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">(Map&lt;String,User&gt; map, List&lt;User&gt; list)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Demo04.test01()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Integer,User&gt; <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Demo04.test02()"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取指定方法参数泛型信息</span></span><br><span class="line">            Method m = Demo04.class.getMethod(<span class="string">"test01"</span>,Map.class,List.class);</span><br><span class="line">            Type[] t =m.getGenericParameterTypes();</span><br><span class="line">            <span class="keyword">for</span>(Type paramType: t)&#123;</span><br><span class="line">                System.out.println(<span class="string">"#"</span>+paramType);</span><br><span class="line">                <span class="keyword">if</span>(paramType <span class="keyword">instanceof</span> ParameterizedType)&#123;</span><br><span class="line">                    Type[] genericTypes = ((ParameterizedType) paramType).getActualTypeArguments();</span><br><span class="line">                    <span class="keyword">for</span>(Type genericType : genericTypes)&#123;</span><br><span class="line">                        System.out.println(<span class="string">"泛型类型:"</span>+genericType);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获得指定方法返回值泛型信息</span></span><br><span class="line">            Method m2 = Demo04.class.getMethod(<span class="string">"test02"</span>,<span class="keyword">null</span>);</span><br><span class="line">            Type returnType = m2.getGenericReturnType();</span><br><span class="line">            <span class="keyword">if</span>(returnType <span class="keyword">instanceof</span> ParameterizedType)&#123;</span><br><span class="line">                Type[] genericTypes = ((ParameterizedType) returnType).getActualTypeArguments();</span><br><span class="line">                <span class="keyword">for</span>(Type genericType: genericTypes)&#123;</span><br><span class="line">                    System.out.println(<span class="string">"返回值,泛型类型:"</span>+genericType);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bjsxt.reflection.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/4.</span></span><br><span class="line"><span class="comment"> * 反射安全检查效率测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo06</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++)&#123;</span><br><span class="line">            u.getUname();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"普通方法调用,执行10亿次,耗时:"</span>+(endTime-startTime)+<span class="string">"ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        Class clazz = u.getClass();</span><br><span class="line">        Method m = clazz.getDeclaredMethod(<span class="string">"getUname"</span>,<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//m.setAccessible(true);</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++)&#123;</span><br><span class="line">            m.invoke(u,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"反射动态方法调用,执行了10亿次,耗时:"</span>+(endTime-startTime)+<span class="string">"ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        Class clazz = u.getClass();</span><br><span class="line">        Method m = clazz.getDeclaredMethod(<span class="string">"getUname"</span>,<span class="keyword">null</span>);</span><br><span class="line">        m.setAccessible(<span class="keyword">true</span>);<span class="comment">//不需要执行访问安全检查</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1000000000L</span>;i++)&#123;</span><br><span class="line">            m.invoke(u,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"反射动态方法调用,跳过了安全检查,执行了10亿次,耗时:"</span>+(endTime-startTime)+<span class="string">"ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException </span>&#123;</span><br><span class="line">        test01();</span><br><span class="line">        test02();</span><br><span class="line">        test03();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="动态编译（DynamicCompile、反射调用main方法）"><a href="#动态编译（DynamicCompile、反射调用main方法）" class="headerlink" title="动态编译（DynamicCompile、反射调用main方法）"></a>动态编译（DynamicCompile、反射调用main方法）</h1><p>● java6.0引入了动态编译机制。<br>● 动态编译的应用场景:<br>    -可以做一个浏览器端编写java代码,上传服务器编译和运行的在线评测系统。<br>    -服务器动态加载某些类文件进行编译<br>● 动态编译的两种做法:<br>    -通过Runtime调用javac,启动新的进程去操作<br>    Runtime run = Runtime.getRuntime();<br>    Process process = um.exec(“javac -cp d:/myjava/ HelloWorld.java”);<br>    -通过JavaCompiler动态编译<br>● 通过javaCompliler动态编译<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">CompileFile</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//动态编译</span></span><br><span class="line">    JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();</span><br><span class="line">    <span class="keyword">int</span> result = compiler.run(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,sourceFile);</span><br><span class="line">    System.out.println(result==<span class="number">0</span>?<span class="string">"编译成功"</span>:<span class="string">"编译失败"</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>● 第一个参数:为java编译器提供参数<br>● 第二个参数:得到java编译器的输出信息<br>● 第三个参数:接收编译器的错误信息<br>● 第四个参数:可变参数(是一个String数组)能传入一个或多个Java源文件<br>● 返回值:0表示编译成功,非0表示编译失败<br>● 通过Runtime.getRuntime()运行启动新的进程运行<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Runtime run = Runtime.getRuntime();</span><br><span class="line">    Process process = run.exec(<span class="string">"java -cp D:/HelloWorld.java"</span>);</span><br></pre></td></tr></table></figure></p>
<p>● 通过反射运行编译好的类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//通过反射运行程序</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">runJavaClassByReflect</span><span class="params">(String dir,String classFile)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            URL[] urls = <span class="keyword">new</span> URL[]&#123;<span class="keyword">new</span> URL(<span class="string">"file:/"</span>+dir)&#125;;</span><br><span class="line">            URLClassLoader loader = <span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">            Class c = loader.loadClass(classFile);</span><br><span class="line">            <span class="comment">//调用加载类的main方法</span></span><br><span class="line">            c.getMethod("main",String[] class).invoke(null,(Object)new String[]&#123;&#125;;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">```java</span><br><span class="line">```java</span><br><span class="line"><span class="keyword">package</span> com.bjsxt.compiler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.tools.JavaCompiler;</span><br><span class="line"><span class="keyword">import</span> javax.tools.ToolProvider;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/4.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//method1();</span></span><br><span class="line">        method2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//通过IO流操作,将字符串存储成一个临时文件(Hi.java),然后调用动态编译方法!</span></span><br><span class="line">        String str = <span class="string">"public class Hi &#123;public static void main(String[] args)&#123;System.out.println(\"Hi,sxt!\")&#125;&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();</span><br><span class="line">        <span class="keyword">int</span> result = compiler.run(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">"D:/HelloWorld.java"</span>);</span><br><span class="line">        System.out.println(result == <span class="number">0</span> ? <span class="string">"编译成功"</span> : <span class="string">"编译失败"</span>);</span><br><span class="line"></span><br><span class="line">        Runtime run = Runtime.getRuntime();</span><br><span class="line">        Process process = run.exec(<span class="string">"java -cp D:/   HelloWorld"</span>);</span><br><span class="line">        InputStream in = process.getInputStream();</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(in));</span><br><span class="line">        String info = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">while</span> ((info = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        URL[] urls = <span class="keyword">new</span> URL[]&#123;<span class="keyword">new</span> URL(<span class="string">"file:/"</span>+<span class="string">"D:/"</span>)&#125;;</span><br><span class="line">        URLClassLoader loader = <span class="keyword">new</span> URLClassLoader(urls);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class c = loader.loadClass(<span class="string">"HelloWorld"</span>);</span><br><span class="line">            <span class="comment">//调用加载类的main方法</span></span><br><span class="line">            Method m = c.getMethod(<span class="string">"main"</span>,String[].class);</span><br><span class="line">            m.invoke(<span class="keyword">null</span>,(Object) <span class="keyword">new</span> String[]&#123;<span class="string">"aa"</span>,<span class="string">"bb"</span>&#125;);</span><br><span class="line">            <span class="comment">//由于可变参数是JDK5.0之后才有。上面代码会编译成:m.invoke(null,"aa","bb"),就发生了参数个数不匹配的问题。</span></span><br><span class="line">            <span class="comment">//因此,必须要加上(Object)转型,避免这个问题。</span></span><br><span class="line">            <span class="comment">//public static void mmm(String[] a,String[] b)</span></span><br><span class="line">            <span class="comment">//public static void main(String[] args)</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="脚本引擎执行Javascript代码（Rhino引擎）"><a href="#脚本引擎执行Javascript代码（Rhino引擎）" class="headerlink" title="脚本引擎执行Javascript代码（Rhino引擎）"></a>脚本引擎执行Javascript代码（Rhino引擎）</h1><p>● JAVA脚本引擎是从JDK6.0之后添加的新功能<br>● 脚本引擎介绍:<br>    -使得Java应用程序可以通过一套固定的接口与各种脚本引擎交互,从而达到在Java平台上调用各种脚本语言的母的。<br>    -Java脚本API是联通Java平台和脚本语言的桥梁。<br>    -可以把一些复杂异变的业务逻辑交给脚本语言处理,这又大大提高了开发效率。<br>● 获得脚本引擎对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///获得脚本引擎对象</span></span><br><span class="line">ScriptEngineManager sem = <span class="keyword">new</span> ScriptEngineManager();</span><br><span class="line">ScriptEngine engine = <span class="function">sem <span class="title">getEngineByName</span><span class="params">(<span class="string">"javascript"</span>)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>● Java脚本API为开发者提供了如下功能:<br>    -获取脚本程序输入,通过脚本引擎运行脚本并返回运行结果,这是最核心的接口。<br>        ● 注意是:接口。Java可以使用各种不同的实现,从而通用的调用js、groovy、python等脚本。<br>        -js使用了：Rhino<br>        Rhino是一种使用了Java语言编写的JavaScript的开源实现,原先由Mozilla开发,现在被集成进入JDK6.0。<br>    -通过脚本引擎的运行上下文在脚本和Java平台间交换数据。<br>    -通过Java应用程序调用脚本函数。<br>● Rhino 是一种使用Java语言编写的JavaScript的开源实现,原先由Mozilla开发,现在被集成进入JDK 6.0<br>    ● 官方首页:<br>    -<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Rhino</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.engine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.script.Invocable;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ScriptException, NoSuchMethodException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//获得脚本引擎对象</span></span><br><span class="line">        ScriptEngineManager sem = <span class="keyword">new</span> ScriptEngineManager();</span><br><span class="line">        ScriptEngine engine = sem.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line">        <span class="comment">//定义变量,存储到引擎上下文中</span></span><br><span class="line">        engine.put(<span class="string">"msg"</span>,<span class="string">"gaoqi is a good man!"</span>);</span><br><span class="line">        String str = <span class="string">"var user = &#123;name:'gaoqi',age:18,schools:['清华大学','北京大学']&#125;;"</span>;</span><br><span class="line">        str += <span class="string">"println(user.name);"</span>;</span><br><span class="line">        <span class="comment">//执行脚本</span></span><br><span class="line">        engine.eval(str);</span><br><span class="line">        engine.eval(<span class="string">"msg = 'sxt is a good school';"</span>);</span><br><span class="line">        System.out.println(engine.get(<span class="string">"msg"</span>));</span><br><span class="line">        System.out.println(<span class="string">"#########################"</span>);</span><br><span class="line">        <span class="comment">//定义函数</span></span><br><span class="line">        engine.eval(<span class="string">"function add(a,b)&#123;var sum=a+b;return sum;&#125;"</span>);</span><br><span class="line">        <span class="comment">//取得调用接口</span></span><br><span class="line">        Invocable jsInvoke = (Invocable) engine;</span><br><span class="line">        <span class="comment">//执行脚本中定义的方法</span></span><br><span class="line">        Object result1 = jsInvoke.invokeFunction(<span class="string">"add"</span>,<span class="keyword">new</span> Object[]&#123;<span class="number">13</span>,<span class="number">20</span>&#125;);</span><br><span class="line">        System.out.println(result1);</span><br><span class="line">        <span class="comment">//导入其他的java包,使用其他包中的java类</span></span><br><span class="line">        String jsCode = <span class="string">"importPackage(java.util);var list = Arrays.asList(\"北京大学\",\"清华大学\",\"南京大学\")"</span>;</span><br><span class="line">        engine.eval(jsCode);</span><br><span class="line">        List&lt;String&gt; list = (List&lt;String&gt;) engine.get(<span class="string">"list"</span>);</span><br><span class="line">        <span class="keyword">for</span>(String temp:list)&#123;</span><br><span class="line">            System.out.println(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行一个js文件(我们将a、js置于项目的src下即可)</span></span><br><span class="line">        URL url = Demo01.class.getClassLoader().getResource(<span class="string">"a.js"</span>);</span><br><span class="line">        FileReader fr = <span class="keyword">new</span> FileReader(url.getPath());</span><br><span class="line">        engine.eval(fr);</span><br><span class="line">        fr.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器"><a href="#字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器" class="headerlink" title="字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器"></a>字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器</h1><p>● JAVA动态性的两种常见实现方式:<br>    -字节码操作<br>    -反射<br>● 运行时操作字节码可以让我们实现如下功能:<br>    -动态生成新的类<br>    -动态改变某个类的结构(添加/删除/修改 新的属性/方法)<br>● 优秀：<br>    -比反射开销小,性能高。<br>    -JAVA asist性能高于反射,低于ASM<br>● BCEL</p>
<pre><code>- Byte Code Engineering Library(BCEL),这是Apache Software Foundation 的Jakarta 项目的一部分,BCEL是java classworking 广泛使用的一种框架，它可以让您深入JVM会变语言进行类操作的细节。BCEL与Javassist有不同的处理字节码方法，BCEL在实际的JVM指令层次上进行操作(BCEL拥有丰富的JVM指令级支持)而Javassist所强调的是源代码级别的工作。
</code></pre><p>● ASM</p>
<pre><code>- 是一个轻量级java字节码操作框架，直接涉及到JVM底层的操作和指令。
</code></pre><p>● CGLIB</p>
<pre><code>- 是一个强大的、高性能、高质量的Code生成类库，基于ASM实现。
</code></pre><p>● Javassist</p>
<pre><code>- 是一个开源的分析、编辑和创建Java字节码的类库，性能较ASM差，跟cglib差不多，但是使用简单、很多开源框架都在使用它。
- 主页：
    ● http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/
    ● javassist的最外层的API和JAVA的反射包中的API颇为类似。
    ● 它主要由CtClass，CtMethod,以及CtField几个类组成。用以执行和JDK反射API中java.lang.Class,java.lang.reflect.Method,java.lang.reflect.Method.Field相同的操作。
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.javassist;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> empno;</span><br><span class="line">    <span class="keyword">private</span> String ename;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Emp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Emp</span><span class="params">(<span class="keyword">int</span> empno, String ename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.empno = empno;</span><br><span class="line">        <span class="keyword">this</span>.ename = ename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEmpno</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> empno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmpno</span><span class="params">(<span class="keyword">int</span> empno)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.empno = empno;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEname</span><span class="params">(String ename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ename = ename;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.javassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CannotCompileException, NotFoundException, IOException </span>&#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.makeClass(<span class="string">"com.bjsxt.bean.Emp"</span>);</span><br><span class="line">        <span class="comment">//创建属性</span></span><br><span class="line">        CtField f1 = CtField.make(<span class="string">"private int empno;"</span>,cc);</span><br><span class="line">        CtField f2 = CtField.make(<span class="string">"private String ename;"</span>,cc);</span><br><span class="line">        cc.addField(f1);</span><br><span class="line">        cc.addField(f2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建方法</span></span><br><span class="line">        CtMethod m1 = CtMethod.make(<span class="string">"public int getEmpno()&#123;return empno;&#125;"</span>,cc);</span><br><span class="line">        CtMethod m2 = CtMethod.make(<span class="string">"public void setEmpno(int empno)&#123;this.empno=empno;&#125;"</span>,cc);</span><br><span class="line">        cc.addMethod(m1);</span><br><span class="line">        cc.addMethod(m2);</span><br><span class="line">        <span class="comment">//添加构造器</span></span><br><span class="line">        CtConstructor constructor = <span class="keyword">new</span> CtConstructor(<span class="keyword">new</span> CtClass[]&#123;CtClass.intType,pool.get(<span class="string">"java.lang.String"</span>)&#125;,cc);</span><br><span class="line">        constructor.setBody(<span class="string">"&#123;this.empno=empno;this.ename=ename;&#125;"</span>);</span><br><span class="line">        cc.addConstructor(constructor);</span><br><span class="line">        <span class="comment">//将上面构造好的类写入到D:/</span></span><br><span class="line">        cc.writeFile(<span class="string">"D:/liuwc/"</span>);</span><br><span class="line">        System.out.println(<span class="string">"生成类,成功!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="字节码操作（Javaassist库介绍、API详解）"><a href="#字节码操作（Javaassist库介绍、API详解）" class="headerlink" title="字节码操作（Javaassist库介绍、API详解）"></a>字节码操作（Javaassist库介绍、API详解）</h1><p>● 方法操作<br>    -修改已有方法的方法体(插入代码到已有方法体)<br>    -新增方法<br>    -删除方法<br>● 构造方法操作<br>    -getConstructors() 不做详解<br>● 注解操作<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Author&#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">year</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Author</span>(name=<span class="string">"Chiba"</span>,year=<span class="number">2005</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>&#123;<span class="keyword">int</span> x,y;&#125;</span><br><span class="line">CtClass cc = ClassPool.getDefault().get(<span class="string">"Point"</span>);</span><br><span class="line">Object[] all = cc.getAnnotations();</span><br><span class="line">Author a = (Author)all[<span class="number">0</span>];</span><br><span class="line">String name = a.name();</span><br><span class="line"><span class="keyword">int</span> year = a.year();</span><br><span class="line">System.out.println(<span class="string">"name:"</span>+name+<span class="string">",year:"</span>+year);</span><br></pre></td></tr></table></figure></p>
<p>● 局限性:</p>
<ul>
<li>JDK5.0新语法不支持(包括泛型、枚举)，不支持注解修改，但可以通过底层的javassist类来解决,具体参考：javassist，bytecode.annotation</li>
<li>不支持数组的初始化,如String[]{“1”,”2”},除非只有数组的容量为1</li>
<li>不支持内部类和匿名类</li>
<li>不支持continue和break表达式</li>
<li>对于继承关系，有些不支持，例如：<br>  -class A{}<br>  -class B extends A{}<br>  -class C extends B{}<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.javassist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/8.</span></span><br><span class="line"><span class="comment"> * 测试javassistAPI</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理类的基本用法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> NotFoundException, IOException, CannotCompileException </span>&#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(<span class="string">"com.bjsxt.javassist.Emp"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = cc.toBytecode();</span><br><span class="line">        System.out.println(Arrays.toString(bytes));</span><br><span class="line">        <span class="comment">//获取类名</span></span><br><span class="line">        System.out.println(cc.getName());</span><br><span class="line">        <span class="comment">//获取简要类名</span></span><br><span class="line">        System.out.println(cc.getSimpleName());</span><br><span class="line">        <span class="comment">//获取父类</span></span><br><span class="line">        System.out.println(cc.getSuperclass());</span><br><span class="line">        <span class="comment">//获取接口</span></span><br><span class="line">        System.out.println(cc.getInterfaces());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> NotFoundException, CannotCompileException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException </span>&#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(<span class="string">"com.bjsxt.javassist.Emp"</span>);</span><br><span class="line">        <span class="comment">//CtMethod m = CtNewMethod.make("public int add(int a,int b)&#123;return a+b;&#125;",cc);</span></span><br><span class="line">        CtMethod m = <span class="keyword">new</span> CtMethod(CtClass.intType,<span class="string">"add"</span>,<span class="keyword">new</span> CtClass[]&#123;CtClass.intType,CtClass.intType&#125;,cc);</span><br><span class="line">        m.setModifiers(Modifier.PUBLIC);</span><br><span class="line">        m.setBody(<span class="string">"&#123;return $1+$2;&#125;"</span>);</span><br><span class="line">        cc.addMethod(m);</span><br><span class="line">        <span class="comment">//通过反射调用新生成的方法</span></span><br><span class="line">        Class clazz = cc.toClass();</span><br><span class="line">        Object obj = clazz.newInstance();<span class="comment">//通过调用Emp无参构造器,创建新的Emp对象</span></span><br><span class="line">        Method method = clazz.getDeclaredMethod(<span class="string">"add"</span>,<span class="keyword">int</span>.class,<span class="keyword">int</span>.class);</span><br><span class="line">        Object result = method.invoke(obj,<span class="number">200</span>,<span class="number">300</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> <span class="keyword">throws</span> NotFoundException, CannotCompileException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException </span>&#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(<span class="string">"com.bjsxt.javassist.Emp"</span>);</span><br><span class="line"></span><br><span class="line">        CtMethod cm = cc.getDeclaredMethod(<span class="string">"sayHello"</span>,<span class="keyword">new</span> CtClass[]&#123;CtClass.intType&#125;);</span><br><span class="line">        cm.insertBefore(<span class="string">"System.out.println($1);System.out.println(\"start!!!\");"</span>);</span><br><span class="line">        cm.insertAt(<span class="number">9</span>,<span class="string">"int b=3;System.out.println(\"b=\"+b);"</span>);</span><br><span class="line">        cm.insertAfter(<span class="string">"System.out.println(\"end!!!\");"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过反射调用新生成的方法</span></span><br><span class="line">        Class clazz = cc.toClass();</span><br><span class="line">        Object obj = clazz.newInstance();<span class="comment">//通过调用Emp无参构造器,创建新的Emp对象</span></span><br><span class="line">        Method method = clazz.getDeclaredMethod(<span class="string">"sayHello"</span>,<span class="keyword">int</span>.class);</span><br><span class="line">        Object result = method.invoke(obj,<span class="number">300</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NotFoundException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> CannotCompileException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span> <span class="keyword">throws</span> NotFoundException, CannotCompileException </span>&#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(<span class="string">"com.bjsxt.javassist.Emp"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//CtField f1 = CtField.make("private int empno;",cc);</span></span><br><span class="line">        CtField f1 = <span class="keyword">new</span> CtField(CtClass.intType,<span class="string">"empno;"</span>,cc);</span><br><span class="line">        f1.setModifiers(Modifier.PRIVATE);</span><br><span class="line">        cc.addField(f1);</span><br><span class="line"></span><br><span class="line">        cc.getDeclaredField(<span class="string">"ename"</span>);<span class="comment">//获取指定的属性</span></span><br><span class="line">        cc.addMethod(CtNewMethod.getter(<span class="string">"getSalary"</span>,f1));</span><br><span class="line">        cc.addMethod(CtNewMethod.getter(<span class="string">"setSalary"</span>,f1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取构造器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test05</span><span class="params">()</span> <span class="keyword">throws</span> NotFoundException </span>&#123;</span><br><span class="line">        ClassPool pool = ClassPool.getDefault();</span><br><span class="line">        CtClass cc = pool.get(<span class="string">"com.bjsxt.javassist.Emp"</span>);</span><br><span class="line">        CtConstructor[] cs = cc.getConstructors();</span><br><span class="line">        <span class="keyword">for</span>(CtConstructor c:cs)&#123;</span><br><span class="line">            System.out.println(c.getLongName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, CannotCompileException, NotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException </span>&#123;</span><br><span class="line">        test05();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）"><a href="#JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）" class="headerlink" title="JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）"></a>JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）</h1><p>● 为什么研究类加载全过程?</p>
<pre><code>- 有助于了解JVM运行过程
- 更深入了解java动态性，(解热部署、动态加载)，提高程序的灵活性。
</code></pre><p><img src="https://slvanass-1256457820.cos.ap-guangzhou.myqcloud.com/2fb054008ca2898e0a17f7d79ce525a1.png" alt="jvm加载机制"><br>● 类加载机制<br>    -JVM把class文件加载到内存，并对数据进行校验、解析和初始化，最终形成JVM可以直接使用的Java类型的过程。<br>    -将class文件字节码内容加载到内存中，并将这些静态数据转换成方法区中的运行时数据结构，在堆中生成一个代表这个类的java.lang.Class对象，作为方法区类型数据的访问入口。这个过程需要类加载器参与。<br>    Class字节码 –&gt; 类加载器 –&gt; Class对象(外部可以通过class对象，作为操作类的入口)<br>    -链接 将Java类的二进制代码合并到JVM的运行状态之中的过程<br>        ● 验证：<br>            -确保加载的类信息符合JVM规范，没有安全方面的问题。<br>        ● 准备：<br>            -正式为类变量(static变量)分配内存并设置类型变量初始值的阶段,这些内存都将在方法区中进行分配。<br>        ● 解析<br>            -虚拟机常量池内的符号引用替换为直接引用的过程。<br>    -初始化<br>        ● 初始化阶段是执行类构造器<clinit>()方法的过程,类构造器<clinit>()方法是由编译器自动收集类中的所有类变量的赋值动作和静态语句块(static块)中的语句合并产生的。<br>        ● 当初始化一个类的时候,如果发现其父类还没有进行过初始化、则需要先触发其父类的初始化。<br>        ● 虚拟机会保证一个类的<clinit>()方法在多线程环境中被正确加锁和同步。<br>        ● 当访问一个Java类的静态域时,只有真正声明这个域的类才会被初始化。</clinit></clinit></clinit></p>
<h1 id="JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）"><a href="#JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）" class="headerlink" title="JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）"></a>JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）</h1><p>● 类的主动引用(一定会发生类的初始化)</p>
<pre><code>- new一个类的对象
- 调用类的静态成员(除了final常量)和静态方法
- 使用java.lang.reflect包的方法对类进行反射调用
- 当虚拟机启动,java Hello,则一定会初始化Hello类,说白了就是先启动main方法所在的类
- 当初始化一个类,如果其父类没有被初始化,则先会初始化他的父类。
</code></pre><p>● 类的被动引用(不会返生类的初始化)</p>
<pre><code>- 当访问一个静态域时,只有真正声明这个域的类才会被初始化
    ● 通过子类引用父类的静态变量,不会导致子类初始化
- 通过数组定义类引用,不会就触发此类的初始化
- 引用常量不会触发此类的初始化(常量在编译阶段就存入调用类的常量池当中了)
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"静态初始化Demo01"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Demo01的main方法"</span>);</span><br><span class="line">        <span class="comment">//主动引用</span></span><br><span class="line">        <span class="comment">//A a = new A();</span></span><br><span class="line">        <span class="comment">//System.out.println(A.width);</span></span><br><span class="line">        <span class="comment">//Class.forName("com.bjsxt.jvm.A");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//被动引用</span></span><br><span class="line">        <span class="comment">//System.out.println(A.MAX);</span></span><br><span class="line">        <span class="comment">//A[] as = new A[10];</span></span><br><span class="line">        System.out.println(B.width);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过子类访问父类本身的静态域(常量),子类本身不会初始化</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"静态初始化B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">A_Father</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> width=<span class="number">100</span>;<span class="comment">//静态变量,静态域 field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX=<span class="number">100</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"静态初始化类A"</span>);</span><br><span class="line">        width=<span class="number">300</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"创建A类的对象"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A_Father</span> <span class="keyword">extends</span> <span class="title">Object</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"静态初始化A_Father"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）"><a href="#JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）" class="headerlink" title="JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）"></a>JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）</h1><p>● 将class文件字节码内容加载到内存中,并将这些静态数据转换成方法区中的运行时数据结构,在堆中生成一个代表这个类的java.lang.Class对象,作为方法区类数据的访问入口。<br>● 类缓存<br>    ● 标准的Java SE类加载器可以按要求查找类,但一旦某个类被加载到类加载器中,它将维持加载(缓存)一段时间。不过,JVM垃圾收集器可以回收这些Class对象。<br>● 类加载器的层次结构(树状结构)<br>    ● 引导类加载器(C语言编写，其余均为java编写)<br>        -它用来加载java的核心库(JAVA_HOME/jre/lib/rt.jar,或sun.boot.class.path路径下的内容),是用原生代码来实现的,并不集成自java.lang.ClassLoader。<br>        -加载扩展类和应用程序类加载器。并指定他们的父类加载器。<br>    ● 扩展类加载器<br>        -用来加载java的扩展库(JAVA_HOME/jre/ext/*.jar,或java.ext.dirs路径下的内容)。java虚拟机的实现会提供一个扩展库目录。该类加载器在此目录里面查找并加载Java类。<br>    ● 应用程序类加载器<br>        -它根据Java应用程序的类路径(classpath,java.class.path)<br>        一般来说,Java应用的类都是由它来完成加载的。<br>        -由sun.misc.Launcher$AppClassLoader实现<br>    ● 自定义类加载器<br>        -开发人员可以通过继承java.lang.ClassLoader类的方式实现自己的类加载器,以满足一些特殊的需求。<br>● 作用：<br>    -java.lang.ClassLoader类的基本职责就是根据一个指定的类的名称,找到或者生成其对饮的字节代码,然后从这些字节代码中定义出一个Java类,即java.lang.Class类的一个实例。<br>    -除此之外,ClassLoader还负责加载Java应用所需的资源,如图像文件和配置文件等。<br>● 相关方法</p>
<pre><code>- getParent() 返回该类加载器的父类加载器。
  loadClass(String name) 加载名称为name的类,返回的结果是java.lang.CLass类的实例。
  findClass(String name) 查找名称为name的类,返回的结果是java.lang.CLass类的实例。
  findLoadedClass(String name) 查找名称为name的已经被加载过的类,返回的结果是java.lang.CLass类的实例。
  defineClass(String name,byte[] b,int off,int len) 把字节数组b中的内容转换为Java类,返回的结果是java.lang.Class类的实例,这个方法被声明为final的。
  resolveClass(Class&lt;?&gt; c) 链接指定的Java类。
- 对于以上给出的方法,表示类名称的name参数的值是类的二进制名称,需要注意的是内部类的表示,如   com.example.Sample$1和com.example.Sample和$inner等表示方式。
</code></pre><p>● 代理模式</p>
<pre><code>- 交给其他加载器来加载指定的类
</code></pre><p>● 双亲委托机制</p>
<pre><code>- 就是某个特定的类加载器在接到加载类的请求时,首先将加载任务委托给父类加载器,依次追溯,知道最高的爷爷辈的,如果父类加载器可以完成类加载任务,就成功返回;只有父类加载器无法完成次加载任务时,才自己去加载。
- 双亲委托机制是为了保证Java核心库的类型安全。
  ● 这种机制就保证不会出现用户自己能定义java.lang.Object类的情况。
- 类加载器除了用于加载类,也是安全的最基本的屏障。
</code></pre><p>● 双亲委托机制是代理模式的一种</p>
<pre><code>- 并不是所有的类加载器都采用双亲委托机制。
- tomcat服务器类加载器也使用代理模式,所不同的是它是首先尝试去加载某个类,如果炸不到再代理给父类加载器。这与一般类加载器的顺序是相反的。
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(ClassLoader.getSystemClassLoader());</span><br><span class="line">        System.out.println(ClassLoader.getSystemClassLoader().getParent());</span><br><span class="line">        System.out.println(ClassLoader.getSystemClassLoader().getParent().getParent());</span><br><span class="line">        System.out.println(System.getProperty(<span class="string">"java.class.path"</span>));</span><br><span class="line">        System.out.println(<span class="string">"#############################"</span>);</span><br><span class="line">        String a = <span class="string">"gaogao"</span>;</span><br><span class="line">        System.out.println(a.getClass().getClassLoader());</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器"><a href="#JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器" class="headerlink" title="JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器"></a>JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器</h1><p>● 自定义类加载器的流程:</p>
<pre><code>- 首先检查请求的类型是否已经被这个类装载器装载到命名空间中了,如果已经装载,直接返回;
- 委派类加载请求给父类加载器,如果父类加载器能够完成,则返回父类加载器加载的class实例。
- 调用本类加载器的findClass(...)方法,试图获取对应的字节码,如果获取的到,则调用defineClass(...)导入类型到方法区;如果获取不到对应的字节码或者其他原因失败,返回异常给loadClass(...)转抛异常,终止加载过程。
- 注意:被两个类加载器加载的同一个类,JVM不认为是相同的类。
</code></pre><p>● 文件类加载器<br>● 网络类加载器<br>● 加密解密类加载器(取反操作,DES对称加密解密)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 自定义文件系统类加载器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileSystemClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String rootDir;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileSystemClassLoader</span><span class="params">(String rootDir)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rootDir = rootDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="comment">//如果要先查询有没有加载过这个类。如果已经加载,则直接返回加载好的类。如果没有,则加载新的类。</span></span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            ClassLoader parent = <span class="keyword">this</span>.getParent();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                c = parent.loadClass(name);<span class="comment">//委派给父类加载</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">//e.printStackTrace();</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(c!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">byte</span>[] classData = getClassData(name);</span><br><span class="line">                <span class="keyword">if</span>(classData==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    c = defineClass(name,classData,<span class="number">0</span>,classData.length);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] getClassData(String classname)&#123;</span><br><span class="line">        String path = rootDir+<span class="string">"/"</span>+classname.replace(<span class="string">"."</span>,<span class="string">"/"</span>)+<span class="string">".class"</span>;</span><br><span class="line">        <span class="comment">//IOUtils,可以使用它将流中的数据转换成字节数组</span></span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream bs = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            is = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];<span class="comment">//1kb</span></span><br><span class="line">            <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>((temp=is.read(buffer))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                bs.write(buffer,<span class="number">0</span>,temp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> bs.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(is!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    is.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(bs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    bs.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 网络类加载器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String rootUrl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NetClassLoader</span><span class="params">(String rootDir)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rootUrl = rootUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="comment">//如果要先查询有没有加载过这个类。如果已经加载,则直接返回加载好的类。如果没有,则加载新的类。</span></span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            ClassLoader parent = <span class="keyword">this</span>.getParent();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                c = parent.loadClass(name);<span class="comment">//委派给父类加载</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">//e.printStackTrace();</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(c!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">byte</span>[] classData = getClassData(name);</span><br><span class="line">                <span class="keyword">if</span>(classData==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    c = defineClass(name,classData,<span class="number">0</span>,classData.length);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] getClassData(String classname)&#123;</span><br><span class="line">        String path = rootUrl+<span class="string">"/"</span>+classname.replace(<span class="string">"."</span>,<span class="string">"/"</span>)+<span class="string">".class"</span>;</span><br><span class="line">        <span class="comment">//IOUtils,可以使用它将流中的数据转换成字节数组</span></span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream bs = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">            is = url.openStream();</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];<span class="comment">//1kb</span></span><br><span class="line">            <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>((temp=is.read(buffer))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                bs.write(buffer,<span class="number">0</span>,temp);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> bs.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(is!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    is.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(bs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    bs.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 测试自定义的FileSystemClassLoader</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        FileSystemClassLoader loader = <span class="keyword">new</span> FileSystemClassLoader(<span class="string">"D:/"</span>);</span><br><span class="line">        FileSystemClassLoader loader2 = <span class="keyword">new</span> FileSystemClassLoader(<span class="string">"D:/"</span>);</span><br><span class="line">        Class&lt;?&gt; c =  loader.loadClass(<span class="string">"HelloWorld"</span>);</span><br><span class="line">        Class&lt;?&gt; c2 =  loader.loadClass(<span class="string">"HelloWorld"</span>);</span><br><span class="line">        Class&lt;?&gt; c3 =  loader2.loadClass(<span class="string">"HelloWorld"</span>);</span><br><span class="line">        Class&lt;?&gt; c4 =  loader2.loadClass(<span class="string">"java.lang.String"</span>);</span><br><span class="line">        Class&lt;?&gt; c5 =  loader2.loadClass(<span class="string">"com.bjsxt.jvm.Demo01"</span>);</span><br><span class="line">        System.out.println(c.hashCode());</span><br><span class="line">        System.out.println(c2.hashCode());</span><br><span class="line">        System.out.println(c3.hashCode());<span class="comment">//同一个类,被不同的加载器加载,JVM认为也是不相同的类</span></span><br><span class="line">        System.out.println(c4.hashCode());</span><br><span class="line">        System.out.println(c4.getClassLoader());<span class="comment">//引导类加载器</span></span><br><span class="line">        System.out.println(c3.getClassLoader());<span class="comment">//自定义加载器</span></span><br><span class="line">        System.out.println(c5.getClassLoader());<span class="comment">//系统默认的类加载器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="JVM核心机制（类加载器、自定加密解密类加载器）"><a href="#JVM核心机制（类加载器、自定加密解密类加载器）" class="headerlink" title="JVM核心机制（类加载器、自定加密解密类加载器）"></a>JVM核心机制（类加载器、自定加密解密类加载器）</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 加密工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EncrptUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        encrpt(<span class="string">"D:/HelloWorld.class"</span>,<span class="string">"D:/temp/HelloWorld.class"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">encrpt</span><span class="params">(String src,String dest)</span></span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            fis = <span class="keyword">new</span> FileInputStream(src);</span><br><span class="line">            fos = <span class="keyword">new</span> FileOutputStream(dest);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> temp = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>((temp=fis.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">                fos.write(temp^<span class="number">0xff</span>);<span class="comment">//取反操作</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(fis!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(fos!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 加载文件系统中加密后的class字节码的类加载器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecrptClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String rootDir;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DecrptClassLoader</span><span class="params">(String rootDir)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rootDir = rootDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="comment">//如果要先查询有没有加载过这个类。如果已经加载,则直接返回加载好的类。如果没有,则加载新的类。</span></span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            ClassLoader parent = <span class="keyword">this</span>.getParent();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                c = parent.loadClass(name);<span class="comment">//委派给父类加载</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">//e.printStackTrace();</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(c!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">byte</span>[] classData = getClassData(name);</span><br><span class="line">                <span class="keyword">if</span>(classData==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    c = defineClass(name,classData,<span class="number">0</span>,classData.length);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] getClassData(String classname)&#123;</span><br><span class="line">        String path = rootDir+<span class="string">"/"</span>+classname.replace(<span class="string">"."</span>,<span class="string">"/"</span>)+<span class="string">".class"</span>;</span><br><span class="line">        <span class="comment">//IOUtils,可以使用它将流中的数据转换成字节数组</span></span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        ByteArrayOutputStream bs = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            is = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line">            <span class="keyword">int</span> temp = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>((temp=is.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">                bs.write(temp^<span class="number">0xff</span>);<span class="comment">//取反操作,相当于解密</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> bs.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(is!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    is.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(bs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    bs.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 测试简单加密解密(取反)操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">//int a = 3; //0000011</span></span><br><span class="line">        <span class="comment">//System.out.println(Integer.toBinaryString(a^0xff));//取反</span></span><br><span class="line">       <span class="comment">//加密后的class文件，正常的类加载器无法加载,报classFormatError</span></span><br><span class="line">       <span class="comment">// FileSystemClassLoader loader = new FileSystemClassLoader("D:/temp");</span></span><br><span class="line">        DecrptClassLoader loader = <span class="keyword">new</span> DecrptClassLoader(<span class="string">"D:/temp"</span>);</span><br><span class="line">        Class&lt;?&gt; c = loader.loadClass(<span class="string">"HelloWorld"</span>);</span><br><span class="line">        System.out.println(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）"><a href="#JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）" class="headerlink" title="JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）"></a>JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）</h1><p>线程上下文类加载器<br>    ● 双亲委派机制以及类加载器的问题</p>
<pre><code>- 一般情况下,保证同一个类中所关联的其他类都是由当前类的类加载器所加载的。
  比如,Class本身是在Ext下找到,那么他里面new出来的一些类就只能用Ext去查找了(不会低一个级别),所以有些明明App可以找到的,却找不到了。
- JDBC API,他有实现的driven部分(mysql/sql server),我们的JDBC API都是由Boot或者Ext来载入的,但是JDBC driver却是由Ext或者APP来载入,那么就有可能找不到driver了。在java领域中,其实只要分成这种API+SPI(Service provide interface,特定厂商提供)的,都会遇到此问题。
- 常见的SPI有JDBC、JCE、JNDI、JAXP和JBI等,这些SPI的接口由Java核心库来提供,如JAXP的SPI接口定义包含在javax.xml.parsers包中。SPI的接口是Java核心库的一部分,是由引导类加载器来加载的:SPI实现的Java类一般是由系统类加载器来加载的。引导类加载器是无法找到SPI的实现类的,因为它只加载Java的核心库。
● 通常当你需要动态加载资源的时候,你至少有三个ClassLoader可以选择
    -1.系统类加载器或叫做应用类加载器(system classloader or application classloader)
    -2.当前类加载器
    -3.当前线程类加载器
● 线程类加载器是为了抛弃双亲委派加载链模式。
    -每个线程都有一个关联的上下文类加载器,如果你使用new Thread()方式生成新的线程,新线程将继承其父线程的上下文类加载器,如果程序对线程上下文类加载器没有任何改动的话,程序中所有的线程将都使用系统类加载器作为上下文类加载器。
● Thread.currentThread().getContextClassLoader()
● Thread.currentThread().setContextClassLoader()
</code></pre><p>Tomcat服务器的类加载机制<br>    ● 一切都是为了安全<br>        -TOMCAT不能使用系统默认的类加载器。<br>            ● 如果TOMCAT跑你的WEB项目使用系统的类加载器那是相当危险的,你可以直接肆无忌惮是操作系统的各个目录了。<br>            ● 对于运行在Java EE容器中的Web应用来说,类加载器的实现方式与一般的Java应用有所不同。<br>            ● 每个Web应用都有一个对应的类加载器实例。该类加载器也使用代理模式(不同于前面说的双亲委托机制),所不同的是它是首先尝试去加载某个类,如果找不到再代理给父类加载器。这与一般类加载器的顺序是相反的。但也是为了保证安全,这样核心库就不在查询范围之内。<br>    ● 为了安全TOMCAT需要实现自己的类加载器。<br>        ● 我可以限制你只能把类写在指定的地方,否则我不给你加载!<br>OSGI原理介绍<br>    ● OSGI(Open Service Gateway Initative)是面向Java的动态模块系统。它为开发人员提供了面向服务和基于组件的运行环境,并提供标准的方式用来管理软件的生命周期。<br>    ● OSGI已经被实现和部署在很多产品上,在开源社区也得到了广泛的支持,Eclipse就是基于OSGI技术来构建的。<br>    ● 原理：</p>
<pre><code>    - OSGI中的每个模块都包含Java包和类,模块可以声明它所依赖的需要导入的其它模块的Java包和类,也可以声明导出自己的包和类,供其它模块使用。也就是说需要能够隐藏和共享一个模块中的某些Java包和类。这是通过OSGI特有的类加载器机制来实现的。OSGI中的每个模块都有对应的一个类加载器。它负责加载模块自己包含的Java包和类。当它需要加载Java核心库的类时,它会代理给父类加载器(通常是启动类加载器)来完成。当她需要加载所导入的Java类时,它会代理给导出此Java类的模块来完成加载。模块也可以显示的声明某些Java包和类,必须由父类加载器来加载。只需要设置系统属性的值即可。
● Equinox
    - OSGI的一个框架实现
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.jvm;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/9.</span></span><br><span class="line"><span class="comment"> * 线程上下文加载器的测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        ClassLoader loader = Demo05.class.getClassLoader();</span><br><span class="line">        System.out.println(loader);</span><br><span class="line"></span><br><span class="line">        ClassLoader loader2 = Thread.currentThread().getContextClassLoader();</span><br><span class="line">        System.out.println(loader2);</span><br><span class="line"></span><br><span class="line">        Thread.currentThread().setContextClassLoader(<span class="keyword">new</span> FileSystemClassLoader(<span class="string">"D:/"</span>));</span><br><span class="line">        System.out.println(Thread.currentThread().getContextClassLoader());</span><br><span class="line"></span><br><span class="line">        Class&lt;com.bjsxt.jvm.Demo01&gt; c = (Class&lt;Demo01&gt;) Thread.currentThread().getContextClassLoader().loadClass(<span class="string">"com.bjsxt.jvm.Demo05"</span>);</span><br><span class="line">        System.out.println(c);</span><br><span class="line">        System.out.println(c.getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）"><a href="#内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）" class="headerlink" title="内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）"></a>内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）</h1><p>内部类介绍<br>    ● 内部类(Nested Class) 嵌套类<br>        -静态内部类<br>        -非静态内部类<br>            ● 普通内部类(也称为:成员内部类)<br>                -在一个类(外部类)中直接定义的内部类<br>            ● 匿名内部类<br>            ● 方法内部类<br>                -在一个方法(外部类的方法)或代码块中定义的内部类<br>    ● 内部类仍然是一个独立的类、在编译之后内部类会被编译成独立的.class文件,但是前面冠以外部类的类名和$符号。<br>    ● 内部类可以使用修饰符(public、protected、default、private)<br>● 静态内部类的基本用法:<br>    -静态内部类可以包含静态成员、非静态成员。<br>    -静态内部类可以直接调用外部类的静态属性、静态方法。但不能调用外部类的普通属性、普通方法。<br>    -在不相关类中,可以直接创建内部类的对象(不需要通过所在外部类)<br>    -静态内部类实际上和外部类联系很少,也就是命名空间上的联系。<br>● 成员内部类基本用法:<br>    -成员内部类就像一个成员变量一样存在于外部类中。<br>    -成员内部类可以访问外部类的所有成员(包含:private的)<br>    -成员内部类的this指内部类对象本身。要拿到外部类对象可以使用:外部类名+.this<br>        ● 成员内部类的对象是一定要绑定到一个外部类的对象上的。因此,创建成员内部类对象时需要持有外部类对象的引用。因此,要先有外部类对象,后有成员内部类对象。<br>    -成员内部类不能有静态成员。<br>● 成员内部类对象的创建方式:<br>        -外部类内部<br>            ● Inner inner = new Inner()<br>        -外部类外部<br>            ● Inner inner = new Outer().new Inner()<br>● 方法类基本用法:<br>    -方法内部类的地位和方法内的局部变量的位置类似。<br>        ● 因此不能修饰局部变量的修饰符也不能修饰局部内部类、譬如public、private、protected、static、transient等。<br>    -方法内部类只能在声明的方法内是可见的<br>        ● 因此定义局部内部类之后,想用的话就要在此方法内直接实例化,记住这里顺序不能反了,一定是要先声明后使用,否则编译器会说找不到。<br>    -方法内部类不能访问定义它的方法内的局部变量,除非这个变量被定义为final。<br>        ● 本质原因:局部变量和方法内部类生命周期不一致所致!<br>    -方法内部类只能包含非静态成员!<br>● 匿名内部类基本用法:<br>    -匿名内部类的实例化方式:new SomeInterfaceOrClass(){……};<br>    意思是创造一个实现了SomeInterfaceOrClass的类的对象;<br>    -根据声明的位置,判断匿名内部类是成员内部类还是方法内部类,注:一般是方法内部类,这是就具备方法内部类的特性。<br>● 三种使用方法:<br>    -继承式<br>    -接口式<br>    -参数式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.innerClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/10.</span></span><br><span class="line"><span class="comment"> * 测试内部类的基本定义方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//静态内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticNestedClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//普通内部类(成员内部类)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">FieldInnerClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//方法内部类(局部内部类)</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">LocalClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//匿名内部类</span></span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;<span class="comment">//两个作用:定义了匿名内部类的类体;创建了匿名内部类的一个实例!</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.innerClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/10.</span></span><br><span class="line"><span class="comment"> * 测试静态内部类的详细用法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Outer02.StaticInnerClass osic = new Outer02.StaticInnerClass();</span></span><br><span class="line">        Outer02.StaticInnerClass osic = <span class="keyword">new</span> Outer02.StaticInnerClass();<span class="comment">//import com.bjsxt.innerClass.StaticInnerClass;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer02</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> d = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ttt</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StaticInnerClass sic = <span class="keyword">new</span> StaticInnerClass();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//静态内部类</span></span><br><span class="line">    <span class="comment">/*private*/</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticInnerClass</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> b = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(d);</span><br><span class="line">            <span class="comment">//静态内部类中不能调用外部类的普通成员、只能调用静态成员!</span></span><br><span class="line">            <span class="comment">//System.out.println(c);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.innerClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/10.</span></span><br><span class="line"><span class="comment"> * 测试成员内部类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer03 out = <span class="keyword">new</span> Outer03();</span><br><span class="line">        Outer03.InnerClass ic = out.new InnerClass();</span><br><span class="line">        ic.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer03</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ttt</span><span class="params">()</span></span>&#123;</span><br><span class="line">        InnerClass ic = <span class="keyword">new</span> InnerClass();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成员内部类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> c = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//static int d =80; 成员内部类不能有静态成员</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> d =<span class="number">80</span>;<span class="comment">//除非声明为final</span></span><br><span class="line">        <span class="comment">//final static Date d2 = new Date();//并且只能是编译器可以确定值的常量表达式</span></span><br><span class="line">        <span class="comment">//static InnerClass ab = new InnerClass();Outer03.InnerClass.ab可以直接获得内部类对象,这时成员内部类对象就完全脱离了外部类的控制!与设计理念相悖</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(a);</span><br><span class="line">            <span class="comment">//成员内部类对象的创建,必须先有外部类对象!</span></span><br><span class="line">            System.out.println(<span class="string">"内部类对象:"</span>+<span class="keyword">this</span>);</span><br><span class="line">            System.out.println(<span class="string">"外部类对象:"</span>+Outer03.<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.innerClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/10.</span></span><br><span class="line"><span class="comment"> * 测试方法内部类(局部内部类)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer04</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">/*final*/</span> <span class="keyword">int</span> a = <span class="number">3</span>;</span><br><span class="line">        <span class="comment">//只在当前方法(test方法)有效</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">            <span class="keyword">int</span> b = <span class="number">10</span>;</span><br><span class="line">            <span class="comment">//static int c = 20; 方法内部类中只能定义非静态成员</span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">void</span> <span class="title">tt</span><span class="params">()</span></span>&#123;</span><br><span class="line">                System.out.println(b);</span><br><span class="line">                <span class="comment">//方法内部类中不能引用所在方法的普通局部变量,除非是常量。原因如下:</span></span><br><span class="line">                <span class="comment">//方法的生命周期和方法内部类对象的生命周期不一致!方法执行完,内部类对象仍然存在!</span></span><br><span class="line">                <span class="comment">//System.out.println(a);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.innerClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by lwc on 2018/4/10.</span></span><br><span class="line"><span class="comment"> * 匿名内部类的测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Outer05 out = <span class="keyword">new</span> Outer05();</span><br><span class="line">        out.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer05</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">(Car c)</span></span>&#123;</span><br><span class="line">        c.run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">3</span>;</span><br><span class="line">        <span class="comment">//匿名内部类(接口式),由于内部类定义在方法中,也是方法内部类</span></span><br><span class="line">        Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//匿名内部类,继承式</span></span><br><span class="line">        Car car = <span class="keyword">new</span> Car()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"子类的车跑"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        car.run();</span><br><span class="line">        test02(<span class="keyword">new</span> Car()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"参数式匿名内部类,车再跑!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"汽车跑!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.liuwc.com/2018/02/12/hxjz/" data-title="Java核心机制 | liuwc&#39;s blog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/02/12/io/" title="IO流详解">
  <strong>上一篇：</strong><br/>
  <span>
  IO流详解</span>
</a>
</div>


<div class="next">
<a href="/2018/01/19/your-titile/"  title="Gallery">
 <strong>下一篇：</strong><br/> 
 <span>Gallery
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Annotation注解和内置注解"><span class="toc-number">1.</span> <span class="toc-text">Annotation注解和内置注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自定义注解"><span class="toc-number">2.</span> <span class="toc-text">自定义注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制读取注解"><span class="toc-number">3.</span> <span class="toc-text">反射机制读取注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制介绍（Class对象获取、合并文件）"><span class="toc-number">4.</span> <span class="toc-text">反射机制介绍（Class对象获取、合并文件）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制（动态操作、构造器、方法、属性、合并文件）"><span class="toc-number">5.</span> <span class="toc-text">反射机制（动态操作、构造器、方法、属性、合并文件）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#反射机制（提高反射效率、操作泛型、操作注解、合并文件）"><span class="toc-number">6.</span> <span class="toc-text">反射机制（提高反射效率、操作泛型、操作注解、合并文件）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态编译（DynamicCompile、反射调用main方法）"><span class="toc-number">7.</span> <span class="toc-text">动态编译（DynamicCompile、反射调用main方法）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#脚本引擎执行Javascript代码（Rhino引擎）"><span class="toc-number">8.</span> <span class="toc-text">脚本引擎执行Javascript代码（Rhino引擎）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器"><span class="toc-number">9.</span> <span class="toc-text">字节码操作（Javaassist库介绍、动态创建新类、属性、方法、构造器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字节码操作（Javaassist库介绍、API详解）"><span class="toc-number">10.</span> <span class="toc-text">字节码操作（Javaassist库介绍、API详解）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）"><span class="toc-number">11.</span> <span class="toc-text">JVM核心机制（类加载过程、JVM内存分析、反射机制核心原理、常量池理解）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）"><span class="toc-number">12.</span> <span class="toc-text">JVM核心机制（类加载过程、初始化、主动引用、被动引用、静态初始化块执行顺序）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）"><span class="toc-number">13.</span> <span class="toc-text">JVM核心机制（类加载器、三种类加载器、代理加载模式、双亲委派机制）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器"><span class="toc-number">14.</span> <span class="toc-text">JVM核心机制（类加载器、自定义文件系统类加载器、网络自定义类加载器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（类加载器、自定加密解密类加载器）"><span class="toc-number">15.</span> <span class="toc-text">JVM核心机制（类加载器、自定加密解密类加载器）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）"><span class="toc-number">16.</span> <span class="toc-text">JVM核心机制（线程上下文类加载器、Web服务器类加载机制、OSGI模块开发原理）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）"><span class="toc-number">17.</span> <span class="toc-text">内部类分类介绍（静态内部类详解、成员内部类详解、Final修饰局部变量问题、匿名内部类）</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="slvanass" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m liuwc <br/>
			Welcome to my blog</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/slvanass" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="liuwc">liuwc</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
